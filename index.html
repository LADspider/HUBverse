<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUBverse - Tắt lơ ngơ - Bật HUBverse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap&subset=vietnamese,latin-ext" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* General Body and Font Styles */
        body {
            font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f7f9fc;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif;
        }
        .hubverse-title, .section-title {
            font-family: 'Quicksand', 'Helvetica Neue', Arial, sans-serif;
        }

        /* Hero Section & 3D Canvas */
        .hero-section {
            background-color: #111827; /* Dark background for night sky */
            position: relative;
            overflow: hidden;
        }
        #hero-3d-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.8;
        }
        .hero-content {
            position: relative;
            z-index: 1;
        }

        /* Navigation */
        .nav-link {
            font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 500;
            color: #4a5568;
            transition: color 0.3s ease, transform 0.2s ease, background-color 0.2s ease;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
        }
        .nav-link:hover, .nav-link.active-nav-link {
            color: #0077b6;
            background-color: #e0f7fa;
            transform: translateY(-2px);
        }

        /* Buttons */
        .btn-login {
            font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif;
            background-color: #00b4d8;
            color: white;
            font-weight: 600;
            padding: 0.6rem 1.2rem;
            border-radius: 0.75rem;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 180, 216, 0.3);
        }
        .btn-login:hover {
            background-color: #0096c7;
            box-shadow: 0 6px 15px rgba(0, 180, 216, 0.4);
        }
        .btn-cta {
            font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif;
            background-color: #fb8500;
            color: white;
            font-weight: 600;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .btn-cta:hover {
            background-color: #e07a00;
            transform: scale(1.05);
        }
        .hero-section .btn-cta {
            background-color: #ffffff;
            color: #111827;
        }
        .hero-section .btn-cta:hover {
            background-color: #f0f0f0;
        }
        
        /* Section/Subsection Titles */
        .section-title {
            font-weight: 700;
            color: #023e8a;
            border-bottom: 3px solid #fb8500;
        }
        .subsection-title {
            font-family: 'Quicksand', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 600;
            color: #0077b6;
            margin-bottom: 1.5rem;
        }

        /* Cards (Features, Products, etc.) */
        .feature-card, .product-card, .document-card, .event-card, .post-card, .team-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e0e0e0;
        }
        .feature-card:hover, .product-card:hover, .document-card:hover, .event-card:hover, .post-card:hover, .team-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        }
        .feature-card .icon-bg {
            width: 4rem; height: 4rem; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 1.5rem; font-size: 1.75rem;
            transition: transform 0.3s ease;
        }
        .feature-card:hover .icon-bg {
            transform: rotate(15deg) scale(1.1);
        }
        .icon-bg-marketplace { background-color: #ffedd5; color: #f97316; }
        .icon-bg-library { background-color: #dcfce7; color: #22c55e; }
        .icon-bg-news { background-color: #fef9c3; color: #eab308; }
        .icon-bg-ai { background-color: #ede9fe; color: #8b5cf6; }
        .icon-bg-social { background-color: #ffe4e6; color: #f43f5e; }

        /* Team Section Styles */
        #team-section {
            background: #0f172a; /* Dark blue, almost black */
            background-image: radial-gradient(circle at 10% 10%, rgba(147, 51, 234, 0.15) 0%, transparent 40%),
                              radial-gradient(circle at 80% 90%, rgba(59, 130, 246, 0.15) 0%, transparent 40%);
        }
        .team-card {
            background-color: #1e293b; /* Darker card background */
            border: 1px solid #334155;
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        .team-card:hover .team-avatar-container::before {
             animation: spin 6s linear infinite;
        }
        .team-avatar-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 1.5rem auto;
        }
        .team-avatar-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            opacity: 0.6;
            transition: opacity 0.4s ease;
        }
        .team-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #f8fafc;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 2;
        }
        
        /* Unique planet glows */
        #team-hoai .team-avatar-container::before { background: radial-gradient(circle, #f43f5e, transparent 70%); }
        #team-duyen .team-avatar-container::before { background: radial-gradient(circle, #38bdf8, transparent 70%); }
        #team-tran .team-avatar-container::before { background: radial-gradient(circle, #34d399, transparent 70%); }
        #team-ngan .team-avatar-container::before { background: radial-gradient(circle, #facc15, transparent 70%); }
        #team-huong .team-avatar-container::before { background: radial-gradient(circle, #a78bfa, transparent 70%); }

        .team-name {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 0.25rem;
        }
        .team-role {
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
         /* Role-specific colors */
        #team-hoai .team-role { color: #fb7185; } /* Rose */
        #team-duyen .team-role { color: #60a5fa; } /* Blue */
        #team-tran .team-role { color: #4ade80; } /* Green */
        #team-ngan .team-role { color: #fde047; } /* Yellow */
        #team-huong .team-role { color: #c4b5fd; } /* Violet */

        @keyframes spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }


        /* Footer */
        .footer {
            background-color: #003554;
            color: #ade8f4;
        }
        .footer a {
            color: #caf0f8;
            transition: color 0.3s ease;
        }
        .footer a:hover {
            color: #ffffff;
        }
        .footer .social-icon {
            transition: transform 0.3s ease;
        }
        .footer .social-icon:hover {
            transform: scale(1.2);
        }

        /* Marketplace & Library Filtering Tabs */
        .library-main-specialization-tabs, .library-sub-specialization-tabs-container,
        .main-specialization-tabs, .sub-specialization-tabs-container {
            display: none; padding-top: 0.75rem; margin-top: 0.75rem;
        }
        .library-main-specialization-tabs.active, .library-sub-specialization-tabs-container.active,
        .main-specialization-tabs.active, .sub-specialization-tabs-container.active {
            display: flex; flex-wrap: wrap; gap: 0.5rem;
        }
        .library-main-specialization-tabs, .main-specialization-tabs { border-top: 1px solid #e5e7eb; }
        .library-sub-specialization-tabs-container { margin-left: 1rem; padding-left: 1rem; border-left: 2px solid #22d3ee; }
        .sub-specialization-tabs-container { margin-left: 1rem; padding-left: 1rem; border-left: 2px solid #fbbf24; }
        .library-sub-specialization-tabs, .sub-specialization-tabs { display: none; flex-wrap: wrap; gap: 0.5rem; }
        .library-sub-specialization-tabs.active, .sub-specialization-tabs.active { display: flex; }

        .library-category-tab-item, .library-sub-category-tab-item,
        .category-tab-item, .sub-category-tab-item {
            padding: 0.5rem 1rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        .library-category-tab-item, .library-sub-category-tab-item {
            border: 1px solid #22d3ee; color: #0891b2; background-color: #cffafe;
        }
        .library-category-tab-item:hover, .library-category-tab-item.active-tab,
        .library-sub-category-tab-item:hover, .library-sub-category-tab-item.active-tab {
            background-color: #22d3ee; color: #0e7490; border-color: #06b6d4;
        }
        .library-sub-category-tab-item { border-color: #67e8f9; background-color: #ecfeff; }
        .library-sub-category-tab-item:hover, .library-sub-category-tab-item.active-tab {
            background-color: #67e8f9; color: #0e7490;
        }
        .category-tab-item, .sub-category-tab-item { /* For Marketplace */
            border: 1px solid #fbbf24; color: #b45309; background-color: #fef3c7;
        }
        .category-tab-item:hover, .category-tab-item.active-tab,
        .sub-category-tab-item:hover, .sub-category-tab-item.active-tab {
            background-color: #fbbf24; color: #78350f; border-color: #f59e0b;
        }
        .sub-category-tab-item {
            border-color: #fcd34d; background-color: #fffbeb;
        }
        .sub-category-tab-item:hover, .sub-category-tab-item.active-tab {
            background-color: #fcd34d; color: #92400e;
        }

        /* News & Events Tabs */
        .news-events-tabs-menu {
            display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 2rem;
            padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb;
        }
        .news-event-tab-button {
            padding: 0.625rem 1.25rem; font-weight: 500; color: #4b5563;
            background-color: #f3f4f6; border-radius: 0.5rem; cursor: pointer;
            transition: all 0.2s ease-in-out; border: 1px solid transparent;
        }
        .news-event-tab-button:hover { background-color: #e5e7eb; color: #1f2937; }
        .news-event-tab-button.active-news-tab {
            background-color: #fbbf24; color: #78350f; font-weight: 600; border-color: #f59e0b;
        }
        .news-event-content-pane { display: none; padding-top: 1rem; }
        .news-event-content-pane.active { display: block; }
        
        /* AI Chatbot */
        .gemini-chat-container {
            background-color: #fff; border-radius: 1rem;
            box-shadow: 0 0 0 1px rgba(0,0,0,.1),0 2px 3px rgba(0,0,0,.1),0 4px 12px rgba(0,0,0,.1);
            padding: 1.5rem; max-width: 800px; margin: auto;
        }
        .gemini-chat-messages {
            height: 450px; overflow-y: auto; padding: 1rem; margin-bottom: 1rem;
            display: flex; flex-direction: column; gap: 1rem;
        }
        .gemini-chat-bubble {
            display: flex; gap: 0.75rem; align-items: flex-start; max-width: 90%;
        }
        .gemini-chat-bubble .avatar {
            width: 2.25rem; height: 2.25rem; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-weight: 500; flex-shrink: 0;
        }
        .gemini-chat-bubble .avatar-user { background-color: #cce7ff; color: #00529b; }
        .gemini-chat-bubble .avatar-ai { background-color: #d1fae5; color: #065f46; }
        .gemini-chat-bubble .message-content {
            background-color: #f3f4f6; padding: 0.75rem 1rem; border-radius: 0.75rem;
            line-height: 1.6; font-size: 0.95rem; word-break: break-word;
        }
        .gemini-chat-bubble.user { margin-left: auto; flex-direction: row-reverse; }
        .gemini-chat-bubble.user .message-content {
            background-color: #e0f2fe; border-top-right-radius: 0.25rem; border-top-left-radius: 0.75rem;
        }
        .gemini-chat-bubble.ai .message-content { border-top-left-radius: 0.25rem; }
        .gemini-chat-input-area {
            display: flex; gap: 0.75rem; padding: 0.75rem;
            background-color: #f9fafb; border-radius: 0.75rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .gemini-chat-input { flex-grow: 1; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem; }
        .gemini-chat-input:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); }
        .gemini-send-button {
            background-color: #2563eb; color: white; padding: 0.75rem 1.25rem;
            border-radius: 0.5rem; border: none; cursor: pointer;
            transition: background-color 0.2s;
        }
        .gemini-send-button:hover { background-color: #1d4ed8; }

        /* Social Networking (Insta-like) */
        .insta-post-card { background-color: #fff; border: 1px solid #dbdbdb; border-radius: 8px; margin-bottom: 1.5rem; }
        .insta-post-header { display: flex; align-items: center; padding: 0.75rem 1rem; }
        .insta-post-header .avatar {
            width: 2.5rem; height: 2.5rem; border-radius: 50%; margin-right: 0.75rem; border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box, linear-gradient(to right, #f9ce34, #ee2a7b, #6228d7) border-box;
        }
        .insta-post-header .username { font-weight: 600; color: #262626; }
        .insta-post-header .location { font-size: 0.75rem; color: #8e8e8e; }
        .insta-post-header .options-btn { margin-left: auto; color: #262626; }
        .insta-post-image { width: 100%; max-height: 600px; object-fit: cover; border-top: 1px solid #efefef; border-bottom: 1px solid #efefef; }
        .insta-post-actions { display: flex; align-items: center; padding: 0.5rem 1rem; }
        .insta-post-actions button {
            background: none; border: none; cursor: pointer; font-size: 1.5rem;
            color: #262626; margin-right: 1rem; transition: color 0.2s;
        }
        .insta-post-actions button:hover { color: #8e8e8e; }
        .insta-post-actions button.liked .fa-heart { color: #ed4956; font-weight: 900; }
        .insta-post-actions .save-btn { margin-left: auto; margin-right: 0; }
        .insta-post-actions .save-btn.saved .fa-bookmark { color: #262626; font-weight: 900; }
        .insta-post-likes { padding: 0 1rem; font-weight: 600; font-size: 0.875rem; color: #262626; }
        .insta-post-caption { padding: 0.5rem 1rem; font-size: 0.875rem; color: #262626; }
        .insta-post-caption .username { font-weight: 600; margin-right: 0.25rem; }
        .insta-post-comments-link { padding: 0 1rem 0.5rem; font-size: 0.875rem; color: #8e8e8e; cursor: pointer; }
        .insta-post-comments-section { display: none; padding: 0.5rem 1rem; border-top: 1px solid #efefef; }
        .insta-post-comments-section.active { display: block; }
        .insta-post-add-comment { display: flex; align-items: center; padding: 0.5rem 1rem; border-top: 1px solid #efefef; }
        .insta-post-add-comment input { flex-grow: 1; border: none; padding: 0.5rem; font-size: 0.875rem; }
        .insta-post-add-comment input:focus { outline: none; }
        .insta-post-add-comment button { background: none; border: none; color: #0095f6; font-weight: 600; cursor: pointer; }
        .insta-sidebar-profile .avatar {
            width: 3.5rem; height: 3.5rem; border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box, linear-gradient(to right, #f9ce34, #ee2a7b, #6228d7) border-box;
        }
        .line-clamp-3 {
            overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 3;
        }

        /* Modal Styling */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: white; padding: 2rem; border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 500px; position: relative;
        }
        .modal-close-btn {
            position: absolute; top: 1rem; right: 1rem; background: none; border: none;
            font-size: 1.5rem; color: #6b7280; cursor: pointer;
        }
        .modal-close-btn:hover { color: #1f2937; }
        .form-input {
            width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db;
            border-radius: 0.5rem; margin-bottom: 1rem; font-size: 0.9rem;
        }
        .form-input:focus { outline: none; border-color: #0077b6; box-shadow: 0 0 0 2px rgba(0, 119, 182, 0.2); }
        .form-label { display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500; color: #374151; }
        .form-button {
            width: 100%; padding: 0.75rem; background-color: #00b4d8; color: white;
            border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease;
        }
        .form-button:hover { background-color: #0096c7; }
        .form-error { color: #dc2626; font-size: 0.875rem; margin-top: -0.5rem; margin-bottom: 1rem; }
        
        /* Page simulation */
        .page-content-section { display: none; }
        .page-content-section.active-page { display: block; }
        #hero-section, #features-overview, #team-section { display: block; } /* Initially visible for home */

        /* Magic effect for CTA Button */
        .btn-cta.magic-effect { position: relative; overflow: hidden; z-index: 1; }
        .btn-cta.magic-effect::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 0; height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%; transform: translate(-50%, -50%); opacity: 0;
            animation: magicLight 0.8s forwards; z-index: -1;
        }
        @keyframes magicLight {
            0% { width: 0; height: 0; opacity: 0.8; }
            100% { width: 300%; height: 300%; opacity: 0; }
        }

        /* Share Modal Specific Styles */
        .share-friend-list {
            max-height: 200px; overflow-y: auto; border: 1px solid #e5e7eb;
            border-radius: 0.5rem; padding: 0.5rem; margin-bottom: 1rem;
        }
        .share-friend-item {
            display: flex; align-items: center; padding: 0.5rem; cursor: pointer;
            border-radius: 0.375rem; transition: background-color 0.2s ease;
        }
        .share-friend-item:hover { background-color: #f3f4f6; }
        .share-friend-item input[type="checkbox"] {
            margin-right: 0.75rem; width: 1.25rem; height: 1.25rem; accent-color: #db2777;
        }
        .share-friend-item .avatar { width: 2rem; height: 2rem; border-radius: 50%; margin-right: 0.75rem; object-fit: cover; }
        .share-friend-item .username { font-weight: 500; color: #374151; }

        /* Custom Notification Toast */
        .notification-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2d3748;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .notification-toast.show {
            opacity: 1;
            transform: translate(-50%, -10px);
        }

    </style>
</head>
<body class="text-gray-700">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" class="text-4xl hubverse-title page-router-link" data-target-page="home">HUBverse</a>
            <nav class="hidden md:flex space-x-1 items-center">
                <a href="#" data-target-page="home" class="nav-link page-router-link active-nav-link">Tổng Quan</a>
                <a href="#" data-target-page="marketplace" class="nav-link page-router-link">Pass Tài Liệu</a>
                <a href="#" data-target-page="digital-library" class="nav-link page-router-link">Thư Viện Số</a>
                <a href="#" data-target-page="news-events" class="nav-link page-router-link">Tin Tức</a>
                <a href="#" data-target-page="ai-chatbot" class="nav-link page-router-link">AI Chat</a>
                <a href="#" data-target-page="social-networking" class="nav-link page-router-link">Kết Nối</a>
            </nav>
            <div id="auth-container">
                 <button id="open-login-modal" class="btn-login">Đăng Nhập</button>
            </div>
            <button class="md:hidden text-gray-600 hover:text-indigo-600 focus:outline-none">
                <i class="fas fa-bars text-2xl"></i>
            </button>
        </div>
    </header>

    <main id="main-content-area">
        <!-- HOME PAGE (HERO + FEATURES) -->
        <section id="hero-section" class="hero-section text-white py-24 md:py-40 page-content-section">
            <div class="hero-content container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-6">HUBverse</h1>
                <p class="text-lg md:text-2xl mb-10 max-w-2xl mx-auto leading-relaxed">Tắt lơ ngơ, bật HUBverse</p>
                <a href="#features-overview" id="explore-now-btn" class="btn-cta text-lg">Khám Phá Ngay <i class="fas fa-rocket ml-2"></i></a>
            </div>
            <canvas id="hero-3d-canvas"></canvas>
        </section>

        <section id="features-overview" class="py-16 md:py-24 page-content-section">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-6 section-title">Những Điều Tuyệt Vời Chờ Đón Bạn</h2>
                <p class="text-center text-gray-600 mb-12 md:mb-20 max-w-xl mx-auto text-lg">HUBverse không chỉ là một trang web, mà là người bạn đồng hành trên hành trình sinh viên.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-10">
                    <div class="feature-card p-8 text-center"><div class="icon-bg icon-bg-marketplace mx-auto"> <i class="fas fa-store"></i> </div><h3 class="text-2xl font-semibold mb-3 text-gray-800">Chợ Sinh Viên HUB</h3><p class="text-gray-600 mb-4">Mua bán, trao đổi tài liệu, đồ dùng học tập dễ dàng, tiện lợi.</p><a href="#" data-target-page="marketplace" class="font-semibold text-orange-500 hover:text-orange-600 transition duration-300 page-router-link">Vào Chợ Ngay <i class="fas fa-arrow-right ml-1"></i></a></div>
                    <div class="feature-card p-8 text-center"><div class="icon-bg icon-bg-library mx-auto"> <i class="fas fa-book-open"></i> </div><h3 class="text-2xl font-semibold mb-3 text-gray-800">Thư Viện Tri Thức</h3><p class="text-gray-600 mb-4">Kho tài liệu số phong phú, chính thống từ nhà trường và cộng đồng.</p><a href="#" data-target-page="digital-library" class="font-semibold text-green-500 hover:text-green-600 transition duration-300 page-router-link">Khám Phá Thư Viện <i class="fas fa-arrow-right ml-1"></i></a></div>
                    <div class="feature-card p-8 text-center"><div class="icon-bg icon-bg-news mx-auto"> <i class="fas fa-bullhorn"></i> </div><h3 class="text-2xl font-semibold mb-3 text-gray-800">HUB News & Events</h3><p class="text-gray-600 mb-4">Không bỏ lỡ bất kỳ tin tức, sự kiện nóng hổi nào của trường.</p><a href="#" data-target-page="news-events" class="font-semibold text-yellow-500 hover:text-yellow-600 transition duration-300 page-router-link">Xem Tin Mới <i class="fas fa-arrow-right ml-1"></i></a></div>
                    <div class="feature-card p-8 text-center"><div class="icon-bg icon-bg-ai mx-auto"> <i class="fas fa-robot"></i> </div><h3 class="text-2xl font-semibold mb-3 text-gray-800">Trợ Lý AI 24/7</h3><p class="text-gray-600 mb-4">Giải đáp mọi thắc mắc học tập, thủ tục nhanh chóng, mọi lúc mọi nơi.</p><a href="#" data-target-page="ai-chatbot" class="font-semibold text-purple-500 hover:text-purple-600 transition duration-300 page-router-link">Hỏi AI Ngay <i class="fas fa-arrow-right ml-1"></i></a></div>
                    <div class="feature-card p-8 text-center"><div class="icon-bg icon-bg-social mx-auto"> <i class="fas fa-users"></i> </div><h3 class="text-2xl font-semibold mb-3 text-gray-800">HUB Connection</h3><p class="text-gray-600 mb-4">Kết nối bạn bè, chia sẻ khoảnh khắc, xây dựng cộng đồng HUBers.</p><a href="#" data-target-page="social-networking" class="font-semibold text-rose-500 hover:text-rose-600 transition duration-300 page-router-link">Tham Gia Cộng Đồng <i class="fas fa-arrow-right ml-1"></i></a></div>
                    <div class="feature-card p-8 text-center bg-gray-100 border-dashed border-gray-300"><div class="icon-bg bg-gray-200 text-gray-500 mx-auto"> <i class="fas fa-puzzle-piece"></i> </div><h3 class="text-2xl font-semibold mb-3 text-gray-700">Tính Năng Sắp Ra Mắt</h3><p class="text-gray-500 mb-4">Nhiều điều thú vị khác đang được HUBverse phát triển!</p><span class="font-semibold text-gray-400">Coming Soon...</span></div>
                </div>
            </div>
        </section>

        <!-- TEAM SECTION -->
        <section id="team-section" class="py-16 md:py-24 page-content-section">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-6 section-title text-white" style="border-color: #38bdf8;">Phi Hành Đoàn HUBverse</h2>
                <p class="text-center text-slate-300 mb-12 md:mb-20 max-w-xl mx-auto text-lg">Những thuyền trưởng tài ba đang chèo lái con tàu HUBverse vươn ra vũ trụ tri thức.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-8">
                    <!-- Team Member 1: Lê Hồng Hoài (COO) -->
                    <div id="team-hoai" class="team-card">
                        <div class="team-avatar-container">
                             <img src="https://i.imgur.com/83p14n4.jpeg" alt="Lê Hồng Hoài - COO" class="team-avatar">
                        </div>
                        <h3 class="team-name">Lê Hồng Hoài</h3>
                        <p class="team-role">COO</p>
                    </div>
                    <!-- Team Member 2: Đỗ Trần Mỹ Duyên (Head of Marketing) -->
                    <div id="team-duyen" class="team-card">
                        <div class="team-avatar-container">
                             <img src="https://i.imgur.com/sYEnBBr.jpeg" alt="Đỗ Trần Mỹ Duyên - Head of Marketing" class="team-avatar">
                        </div>
                        <h3 class="team-name">Đỗ Trần Mỹ Duyên</h3>
                        <p class="team-role">Head of Marketing</p>
                    </div>
                    <!-- Team Member 3: Nguyễn Thị Bảo Trân (Web Operations Manager) -->
                    <div id="team-tran" class="team-card">
                        <div class="team-avatar-container">
                             <img src="https://i.imgur.com/SGFV51g.jpeg" alt="Nguyễn Thị Bảo Trân - Web Operations Manager" class="team-avatar">
                        </div>
                        <h3 class="team-name">Nguyễn Thị Bảo Trân</h3>
                        <p class="team-role">Web Operations Manager</p>
                    </div>
                    <!-- Team Member 4: Trần Thiên Ngân (Creative Design Director) -->
                    <div id="team-ngan" class="team-card">
                        <div class="team-avatar-container">
                             <img src="https://i.imgur.com/YqIARLz.jpeg" alt="Trần Thiên Ngân - Creative Design Director" class="team-avatar">
                        </div>
                        <h3 class="team-name">Trần Thiên Ngân</h3>
                        <p class="team-role">Creative Design Director</p>
                    </div>
                    <!-- Team Member 5: Nguyễn Thị Kim Hường (Content Strategist) -->
                    <div id="team-huong" class="team-card">
                        <div class="team-avatar-container">
                             <img src="https://i.imgur.com/G2ApB5R.jpeg" alt="Nguyễn Thị Kim Hường - Content Strategist" class="team-avatar">
                        </div>
                        <h3 class="team-name">Nguyễn Thị Kim Hường</h3>
                        <p class="team-role">Content Strategist</p>
                    </div>
                </div>
            </div>
        </section>


        <!-- MARKETPLACE PAGE -->
        <section id="marketplace" class="py-16 md:py-24 bg-orange-50 page-content-section">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 section-title" style="border-color: #f97316;">Chợ Sinh Viên HUBverse</h2>
                <p class="text-center text-gray-600 mb-12 md:mb-16 max-w-xl mx-auto text-lg">Nơi "pass" đồ cũ, tìm "deal" hời cho mọi nhu cầu học tập và đời sống sinh viên.</p>
                <!-- Filter UI will be here -->
                <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    <!-- Products will be dynamically loaded here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- DIGITAL LIBRARY PAGE -->
        <section id="digital-library" class="py-16 md:py-24 bg-sky-50 page-content-section">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 section-title" style="border-color: #0ea5e9;">Thư Viện Tri Thức HUB</h2>
                <p class="text-center text-gray-600 mb-12 md:mb-16 max-w-xl mx-auto text-lg">Nguồn tài liệu học thuật vô tận, từ bài giảng, sách chuyên khảo đến nghiên cứu khoa học mới nhất.</p>
                <!-- Filter UI will be here -->
                <div id="document-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                     <!-- Documents will be dynamically loaded here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- NEWS & EVENTS PAGE -->
        <section id="news-events" class="py-16 md:py-24 bg-yellow-50 page-content-section">
            <!-- Content remains static for now, can be dynamic in future -->
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 md:mb-16 section-title" style="border-color: #f59e0b;">HUB News & Events Feed</h2>
                <div id="news-events-tabs-menu" class="news-events-tabs-menu">
                    <button class="news-event-tab-button active-news-tab" data-target="available-activities-content"><i class="fas fa-calendar-check mr-2"></i>Hoạt Động Đang Diễn Ra</button>
                    <button class="news-event-tab-button" data-target="volunteer-activities-content"><i class="fas fa-hands-helping mr-2"></i>Hoạt Động Tình Nguyện</button>
                    <button class="news-event-tab-button" data-target="academic-competitions-content"><i class="fas fa-trophy mr-2"></i>Cuộc Thi Học Thuật</button>
                </div>
                <div id="available-activities-content" class="news-event-content-pane active">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                         <div class="event-card hover:shadow-amber-200/50"><img src="https://placehold.co/400x220/FEF3C7/D97706?text=Workshop" alt="Workshop Kỹ năng" class="w-full h-48 object-cover rounded-t-xl" onerror="this.src='https://placehold.co/400x220/E2E8F0/2D3748?text=Ảnh+Lỗi';"><div class="p-6"><span class="event-tag tag-workshop mb-2 inline-block">Workshop</span><h4 class="text-xl font-semibold mb-2 text-gray-800">Kỹ Năng Phỏng Vấn Chinh Phục Nhà Tuyển Dụng</h4><p class="text-gray-600 text-sm mb-3"><i class="fas fa-clock mr-1"></i> 09:00, 15/07 - Hội trường A1</p><p class="text-gray-700 text-sm mb-4 line-clamp-3">Rèn luyện kỹ năng phỏng vấn với chuyên gia nhân sự, tự tin ứng tuyển mọi vị trí.</p><a href="#" class="font-semibold text-amber-600 hover:text-amber-700">Đăng ký <i class="fas fa-arrow-right ml-1"></i></a></div></div>
                         <div class="event-card hover:shadow-amber-200/50"><img src="https://placehold.co/400x220/FEF3C7/D97706?text=Job+Fair" alt="Ngày hội việc làm" class="w-full h-48 object-cover rounded-t-xl" onerror="this.src='https://placehold.co/400x220/E2E8F0/2D3748?text=Ảnh+Lỗi';"><div class="p-6"><span class="event-tag tag-event mb-2 inline-block">Sự kiện lớn</span><h4 class="text-xl font-semibold mb-2 text-gray-800">Ngày Hội Việc Làm HUB Connect 2025</h4><p class="text-gray-600 text-sm mb-3"><i class="fas fa-calendar-day mr-1"></i> Cả ngày, 20/07 - Sân vận động trường</p><p class="text-gray-700 text-sm mb-4 line-clamp-3">Hàng ngàn cơ hội việc làm từ các doanh nghiệp hàng đầu. Đừng bỏ lỡ!</p><a href="#" class="font-semibold text-amber-600 hover:text-amber-700">Xem chi tiết <i class="fas fa-arrow-right ml-1"></i></a></div></div>
                    </div>
                </div>
                <!-- Other panes... -->
            </div>
        </section>

        <!-- AI CHATBOT PAGE -->
        <section id="ai-chatbot" class="py-16 md:py-24 bg-gray-100 page-content-section">
            <div class="container mx-auto px-6">
                 <h2 class="text-3xl md:text-4xl font-bold text-center mb-4 section-title" style="border-color: #4f46e5;">Trò Chuyện Cùng HUB AI</h2>
                 <p class="text-center text-gray-600 mb-12 md:mb-16 max-w-xl mx-auto text-lg">Trợ lý ảo thông minh, sẵn sàng giải đáp mọi thắc mắc của bạn 24/7.</p>
                 <div class="gemini-chat-container">
                     <div id="gemini-chat-messages" class="gemini-chat-messages">
                         <!-- Chat messages will be dynamically loaded here -->
                     </div>
                     <div class="gemini-chat-input-area">
                         <input type="text" id="gemini-chat-input" placeholder="Nhắn tin cho HUB AI..." class="gemini-chat-input">
                         <button id="gemini-send-button" class="gemini-send-button"><i class="fas fa-paper-plane"></i></button>
                     </div>
                 </div>
            </div>
        </section>

        <!-- SOCIAL NETWORKING PAGE -->
        <section id="social-networking" class="py-16 md:py-24 bg-pink-50 page-content-section">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 md:mb-16 section-title" style="border-color: #ec4899;">HUB Connection - Khoảnh Khắc HUBers</h2>
                <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
                    <div id="social-feed-container" class="md:col-span-8 space-y-6">
                        <!-- New Post Box -->
                         <div id="new-post-box" class="bg-white p-4 rounded-lg shadow border border-gray-200" style="display: none;">
                             <!-- Content populated by JS when user is logged in -->
                         </div>
                        <!-- Posts will be dynamically loaded here -->
                    </div>
                    <aside id="social-sidebar-container" class="md:col-span-4 space-y-6">
                        <!-- Sidebar profile and suggestions loaded by JS -->
                    </aside>
                </div>
            </div>
        </section>

    </main>

    <!-- CTA & FOOTER (Always visible) -->
    <section id="cta-section" class="py-20 md:py-32 bg-gradient-to-r from-cyan-500 to-blue-500 text-white">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-6">Sẵn Sàng Gia Nhập Cộng Đồng HUBverse?</h2>
            <p class="text-lg md:text-xl mb-10 max-w-xl mx-auto">Đăng ký miễn phí ngay hôm nay để trải nghiệm tất cả tiện ích tuyệt vời!</p>
            <button id="open-register-modal-cta" class="btn-cta bg-white text-blue-600 hover:bg-gray-100 text-lg">Đăng Ký Ngay <i class="fas fa-user-plus ml-2"></i></button>
        </div>
    </section>

    <footer id="contact" class="footer py-16">
        <!-- Footer content remains the same -->
        <div class="container mx-auto px-6">
             <div class="grid grid-cols-1 md:grid-cols-3 gap-10 mb-8">
                 <div><h3 class="text-3xl font-bold mb-4 hubverse-title" style="color: #ffffff;">HUBverse</h3><p class="text-gray-300 leading-relaxed">Nền tảng sinh viên vì sinh viên, bởi sinh viên HUB.</p><p class="text-gray-400 mt-2 text-sm">Trường Đại học Ngân hàng TP.HCM (HUB)</p></div>
                 <div><h4 class="text-xl font-semibold mb-4 text-cyan-300">Khám Phá</h4><ul class="space-y-2"><li><a href="#" data-target-page="home" class="page-router-link">Tổng Quan</a></li><li><a href="#" data-target-page="marketplace" class="page-router-link">Chợ Sinh Viên</a></li><li><a href="#" data-target-page="digital-library" class="page-router-link">Thư Viện</a></li></ul></div>
                 <div><h4 class="text-xl font-semibold mb-4 text-cyan-300">Kết Nối Với HUBverse</h4><div class="flex space-x-5 mb-4"><a href="#" class="text-2xl social-icon"><i class="fab fa-facebook-square"></i></a><a href="#" class="text-2xl social-icon"><i class="fab fa-instagram-square"></i></a></div><p class="text-gray-300 text-sm">Email: support@hubverse.edu.vn</p></div>
             </div>
             <div class="mt-10 pt-8 border-t border-gray-700 text-center text-gray-400 text-sm"><p>&copy; <span id="currentYear"></span> HUBverse Team. All rights reserved.</p></div>
         </div>
    </footer>

    <!-- MODALS -->
    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-login-modal" class="modal-close-btn">&times;</button>
            <h3 class="text-2xl font-semibold mb-6 text-center hubverse-title">Đăng Nhập HUBverse</h3>
            <form id="login-form">
                <div>
                    <label for="login-email" class="form-label">Email</label>
                    <input type="email" id="login-email" class="form-input" placeholder="nhapemail@hub.edu.vn" required>
                </div>
                <div>
                    <label for="login-password" class="form-label">Mật khẩu</label>
                    <input type="password" id="login-password" class="form-input" placeholder="********" required>
                </div>
                <p id="login-error" class="form-error" style="display: none;"></p>
                <button type="submit" class="form-button mt-4">Đăng Nhập</button>
                <p class="text-xs text-center mt-4 text-gray-500">Chưa có tài khoản? <a href="#" id="show-register-from-login" class="text-orange-500 hover:underline">Đăng ký ngay</a></p>
            </form>
        </div>
    </div>

    <div id="register-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-register-modal" class="modal-close-btn">&times;</button>
            <h3 class="text-2xl font-semibold mb-6 text-center hubverse-title">Đăng Ký Tài Khoản</h3>
            <form id="register-form">
                <div><label for="register-name" class="form-label">Họ và Tên</label><input type="text" id="register-name" class="form-input" placeholder="Nguyễn Văn A" required></div>
                <div><label for="register-email" class="form-label">Email</label><input type="email" id="register-email" class="form-input" placeholder="emailcuaban@hub.edu.vn" required></div>
                <div><label for="register-password" class="form-label">Mật khẩu</label><input type="password" id="register-password" class="form-input" placeholder="Tạo mật khẩu (ít nhất 6 ký tự)" required></div>
                <p id="register-error" class="form-error" style="display: none;"></p>
                <button type="submit" class="form-button mt-4">Đăng Ký</button>
                <p class="text-xs text-center mt-4 text-gray-500">Đã có tài khoản? <a href="#" id="show-login-from-register" class="text-orange-500 hover:underline">Đăng nhập</a></p>
            </form>
        </div>
    </div>
    
    <div id="share-modal" class="modal-overlay">
      <div class="modal-content">
          <button id="close-share-modal" class="modal-close-btn">&times;</button>
          <h3 class="text-xl font-semibold mb-4 text-center">Chia sẻ bài viết</h3>
          <p class="text-center text-gray-600 mb-4">Chọn bạn bè để chia sẻ bài viết này:</p>
          <div id="share-friend-list" class="share-friend-list">
              <!-- Dynamically loaded friends -->
          </div>
          <div class="text-center">
              <button id="confirm-share-btn" class="bg-pink-500 hover:bg-pink-600 text-white font-semibold py-2 px-6 rounded-lg">Chia sẻ</button>
          </div>
      </div>
    </div>
    
    <div id="notification-toast" class="notification-toast"></div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setDoc, doc, getDoc, collection, onSnapshot, updateDoc, arrayUnion, arrayRemove, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        document.addEventListener('DOMContentLoaded', async function() {
            // --- FIREBASE SETUP ---
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "AIza...", authDomain: "...", projectId: "..." }; // Fallback for local dev
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-hubverse';

            setLogLevel('debug'); // For detailed console logs

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            let currentUser = null;
            let currentUserData = null;

            // Function to show a toast notification
            function showToast(message) {
                const toast = document.getElementById('notification-toast');
                if (!toast) return;
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            // --- AUTHENTICATION ---
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth initialization failed:", error);
                await signInAnonymously(auth); // Fallback to anonymous
            }
            
            onAuthStateChanged(auth, async (user) => {
                if (user && !user.isAnonymous) {
                    currentUser = user;
                    // Fetch user data from Firestore
                    const userDocRef = doc(db, `/artifacts/${appId}/users`, user.uid);
                    const userDocSnap = await getDoc(userDocRef);
                    if (userDocSnap.exists()) {
                        currentUserData = { id: user.uid, ...userDocSnap.data() };
                    } else {
                        // This case might happen if user doc creation failed after registration
                        currentUserData = { id: user.uid, name: user.email.split('@')[0], email: user.email, friends: [], savedPosts: [] };
                    }
                    updateUIAfterLogin();
                    loadSocialFeed();
                    loadChatHistory();
                } else {
                    currentUser = null;
                    currentUserData = null;
                    updateUIAfterLogout();
                    loadSocialFeed(); // Load public feed
                }
            });

            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginError = document.getElementById('login-error');
            const registerError = document.getElementById('register-error');

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = loginForm['login-email'].value;
                const password = loginForm['login-password'].value;
                try {
                    loginError.style.display = 'none';
                    await signInWithEmailAndPassword(auth, email, password);
                    closeModal(loginModal);
                    showToast("Đăng nhập thành công!");
                } catch (error) {
                    console.error("Login Error:", error);
                    loginError.textContent = "Email hoặc mật khẩu không đúng.";
                    loginError.style.display = 'block';
                }
            });

            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = registerForm['register-name'].value;
                const email = registerForm['register-email'].value;
                const password = registerForm['register-password'].value;
                try {
                    registerError.style.display = 'none';
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    // Create a user document in Firestore
                    const userDocRef = doc(db, `/artifacts/${appId}/users`, userCredential.user.uid);
                    await setDoc(userDocRef, {
                        name: name,
                        username: email.split('@')[0],
                        email: email,
                        avatar: `https://placehold.co/56x56/FFE4E6/DC2626?text=${name.charAt(0)}`,
                        friends: [],
                        savedPosts: [],
                        createdAt: serverTimestamp()
                    });
                    closeModal(registerModal);
                    showToast("Đăng ký thành công! Đang đăng nhập...");
                } catch (error) {
                    console.error("Register Error:", error);
                    registerError.textContent = "Đăng ký không thành công. Email có thể đã tồn tại.";
                    registerError.style.display = 'block';
                }
            });

            function updateUIAfterLogin() {
                const authContainer = document.getElementById('auth-container');
                const newPostBox = document.getElementById('new-post-box');
                
                if (!currentUserData) return;
                
                authContainer.innerHTML = `
                    <div class="flex items-center gap-4">
                        <span class="font-semibold text-gray-700 hidden sm:block">${currentUserData.name}</span>
                        <img src="${currentUserData.avatar}" alt="avatar" class="w-10 h-10 rounded-full cursor-pointer">
                        <button id="logout-btn" class="text-sm text-gray-500 hover:text-red-500"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                `;
                document.getElementById('logout-btn').addEventListener('click', async () => {
                    await signOut(auth);
                    showToast("Đã đăng xuất.");
                });
                
                newPostBox.style.display = 'block';
                newPostBox.innerHTML = `
                    <div class="flex items-center">
                        <img src="${currentUserData.avatar}" alt="User Avatar" class="w-10 h-10 rounded-full mr-3">
                        <input type="text" placeholder="Bạn đang nghĩ gì, ${currentUserData.name}?" class="w-full p-2 border border-gray-300 rounded-full focus:ring-pink-500 focus:border-pink-500 text-sm bg-gray-50">
                    </div>
                    <div class="flex justify-end mt-3 pt-3 border-t border-gray-200">
                        <button class="text-pink-600 hover:bg-pink-100 py-2 px-3 rounded-md text-sm mr-2"><i class="fas fa-image mr-1"></i> Ảnh/Video</button>
                        <button class="bg-pink-500 hover:bg-pink-600 text-white font-semibold py-2 px-4 rounded-md text-sm">Đăng</button>
                    </div>
                `;
            }

            function updateUIAfterLogout() {
                document.getElementById('auth-container').innerHTML = `<button id="open-login-modal" class="btn-login">Đăng Nhập</button>`;
                document.getElementById('open-login-modal').addEventListener('click', (e) => { e.preventDefault(); openModal(loginModal); });
                document.getElementById('new-post-box').style.display = 'none';
            }
            
            // --- DATA LOADING & RENDERING ---
            const productGrid = document.getElementById('product-grid');
            const documentGrid = document.getElementById('document-grid');
            const socialFeedContainer = document.getElementById('social-feed-container');

            // Listen for Products
            const productsCol = collection(db, `/artifacts/${appId}/public/data/products`);
            onSnapshot(productsCol, (snapshot) => {
                if(!productGrid) return;
                productGrid.innerHTML = '';
                snapshot.docs.forEach(doc => {
                    const product = { id: doc.id, ...doc.data() };
                    const card = createProductCard(product);
                    productGrid.appendChild(card);
                });
            });

             // Listen for Documents
            const documentsCol = collection(db, `/artifacts/${appId}/public/data/documents`);
            onSnapshot(documentsCol, (snapshot) => {
                if(!documentGrid) return;
                documentGrid.innerHTML = '';
                snapshot.docs.forEach(doc => {
                    const documentData = { id: doc.id, ...doc.data() };
                    const card = createDocumentCard(documentData);
                    documentGrid.appendChild(card);
                });
            });

            // Load Social Feed
            function loadSocialFeed() {
                const postsCol = collection(db, `/artifacts/${appId}/public/data/posts`);
                onSnapshot(postsCol, (snapshot) => {
                    const feedContainer = document.getElementById('social-feed-container');
                    if(!feedContainer) return;
                    // Clear only post cards, not the new post box
                    feedContainer.querySelectorAll('.insta-post-card').forEach(el => el.remove());
                    snapshot.docs.sort((a,b) => b.data().createdAt?.toMillis() - a.data().createdAt?.toMillis()).forEach(doc => {
                        const post = { id: doc.id, ...doc.data() };
                        const card = createPostCard(post);
                        feedContainer.appendChild(card);
                    });
                });
                
                // Load sidebar (profile + suggestions)
                loadSocialSidebar();
            }

            // --- UI ELEMENT CREATION FUNCTIONS ---
            function createProductCard(product) {
                const card = document.createElement('div');
                card.className = 'product-card flex flex-col';
                // Add data attributes for filtering
                card.dataset.category = product.category || 'all';
                card.dataset.mainSpecTag = product.mainSpec || '';
                card.dataset.subSpecTag = product.subSpec || '';

                card.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-52 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/E2E8F0/2D3748?text=Ảnh+Lỗi';">
                    <div class="p-5 flex flex-col flex-grow">
                        <h3 class="text-lg font-semibold mb-2 text-gray-800">${product.name}</h3>
                        <p class="text-xl mb-2" style="color: #d90429; font-weight: 700;">${product.price.toLocaleString('vi-VN')} VNĐ</p>
                        <p class="text-xs text-gray-500 mb-1"><i class="fas fa-user-circle mr-1"></i> ${product.seller}</p>
                        <p class="text-xs text-gray-500 mb-3"><i class="fas fa-tag mr-1"></i> ${product.tags.join(' / ')}</p>
                        <p class="text-gray-600 text-sm mb-4 flex-grow line-clamp-3">${product.description}</p>
                        <button class="mt-auto w-full font-semibold py-2.5 px-4 rounded-lg text-sm" style="background-color: #2a9d8f; color: white;"><i class="fas fa-cart-plus mr-2"></i>Thêm vào giỏ</button>
                    </div>
                `;
                return card;
            }
            
            function createDocumentCard(docData) {
                const card = document.createElement('div');
                card.className = 'document-card p-6 text-center hover:shadow-sky-200/50';
                card.innerHTML = `
                    <img src="https://placehold.co/150x200/E0F2FE/0EA5E9?text=${docData.type}" alt="${docData.title}" class="w-24 h-32 object-contain rounded-lg mb-4 mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/150x200/E2E8F0/2D3748?text=Ảnh+Lỗi';">
                    <h3 class="text-lg font-semibold mb-2 text-gray-800">${docData.title}</h3>
                    <p class="text-xs text-gray-500 mb-1">${docData.author}</p>
                    <p class="text-xs text-gray-500 mb-3"><span class="bg-sky-100 text-sky-700 py-0.5 px-2 rounded-full">${docData.type}</span></p>
                    <a href="${docData.url}" target="_blank" class="w-full block font-semibold py-2 px-4 rounded-lg text-sm" style="background-color: #0096c7; color: white;"><i class="fas fa-eye mr-2"></i>Xem / Tải</a>
                `;
                return card;
            }

            function createPostCard(post) {
                const article = document.createElement('article');
                article.className = 'insta-post-card';
                article.dataset.postId = post.id;
                
                const isLiked = currentUserData?.likedPosts?.includes(post.id);
                const isSaved = currentUserData?.savedPosts?.includes(post.id);

                article.innerHTML = `
                    <header class="insta-post-header">
                        <img src="${post.authorAvatar}" alt="${post.authorName} Avatar" class="avatar">
                        <div><a href="#" class="username">${post.authorUsername}</a><div class="location">${post.location}</div></div>
                        <button class="options-btn"><i class="fas fa-ellipsis-h"></i></button>
                    </header>
                    <img src="${post.imageUrl}" alt="Post image" class="insta-post-image">
                    <section class="insta-post-actions">
                        <button class="like-btn ${isLiked ? 'liked' : ''}"><i class="fa${isLiked ? 's' : 'r'} fa-heart"></i></button>
                        <button class="comment-btn"><i class="far fa-comment"></i></button>
                        <button class="share-btn"><i class="far fa-paper-plane"></i></button>
                        <button class="save-btn ${isSaved ? 'saved' : ''}"><i class="fa${isSaved ? 's' : 'r'} fa-bookmark"></i></button>
                    </section>
                    <section class="insta-post-likes"><span class="like-count">${post.likes}</span> lượt thích</section>
                    <section class="insta-post-caption"><a href="#" class="username">${post.authorUsername}</a><span>${post.caption}</span></section>
                    <a href="#" class="insta-post-comments-link comment-btn">Xem tất cả <span class="comment-count">${post.comments?.length || 0}</span> bình luận</a>
                    <section class="insta-post-add-comment"><input type="text" placeholder="Thêm bình luận..."><button>Đăng</button></section>
                `;
                
                // Add event listeners for interactions
                const likeBtn = article.querySelector('.like-btn');
                likeBtn.addEventListener('click', () => handleLike(post.id, likeBtn));
                
                const saveBtn = article.querySelector('.save-btn');
                saveBtn.addEventListener('click', () => handleSave(post.id, saveBtn));

                return article;
            }

            async function handleLike(postId, button) {
                if (!currentUser) {
                    showToast("Vui lòng đăng nhập để thích bài viết.");
                    openModal(loginModal);
                    return;
                }
                const postRef = doc(db, `/artifacts/${appId}/public/data/posts`, postId);
                const userRef = doc(db, `/artifacts/${appId}/users`, currentUser.uid);

                const currentlyLiked = button.classList.contains('liked');

                try {
                    if (currentlyLiked) {
                        await updateDoc(postRef, { likes: (await getDoc(postRef)).data().likes - 1 });
                        await updateDoc(userRef, { likedPosts: arrayRemove(postId) });
                    } else {
                        await updateDoc(postRef, { likes: (await getDoc(postRef)).data().likes + 1 });
                        await updateDoc(userRef, { likedPosts: arrayUnion(postId) });
                    }
                    // The onSnapshot will automatically update the UI
                } catch(error) {
                    console.error("Error liking post: ", error);
                    showToast("Có lỗi xảy ra, vui lòng thử lại.");
                }
            }
            
            async function handleSave(postId, button) {
                 if (!currentUser) {
                    showToast("Vui lòng đăng nhập để lưu bài viết.");
                    openModal(loginModal);
                    return;
                }
                const userRef = doc(db, `/artifacts/${appId}/users`, currentUser.uid);
                const currentlySaved = button.classList.contains('saved');

                try {
                     if (currentlySaved) {
                        await updateDoc(userRef, { savedPosts: arrayRemove(postId) });
                        showToast("Đã bỏ lưu bài viết.");
                    } else {
                        await updateDoc(userRef, { savedPosts: arrayUnion(postId) });
                        showToast("Đã lưu bài viết.");
                    }
                } catch(error) {
                     console.error("Error saving post: ", error);
                     showToast("Có lỗi xảy ra, vui lòng thử lại.");
                }
            }

            function loadSocialSidebar() {
                const container = document.getElementById('social-sidebar-container');
                if (!container) return;

                let profileHtml = '';
                if(currentUserData) {
                    profileHtml = `
                    <div class="bg-white p-5 rounded-lg shadow border border-gray-200 insta-sidebar-profile">
                        <div class="flex items-center mb-4">
                            <img src="${currentUserData.avatar}" alt="Your Avatar" class="avatar rounded-full mr-4">
                            <div>
                                <p class="font-semibold text-base text-gray-800">${currentUserData.name}</p>
                                <p class="text-sm text-gray-500">@${currentUserData.username}</p>
                            </div>
                        </div>
                        <div class="flex justify-around text-center text-sm text-gray-600 mb-4">
                            <div><span class="font-bold block text-gray-800 text-base">0</span><span class="text-xs">bài viết</span></div>
                            <div><span class="font-bold block text-gray-800 text-base">${currentUserData.friends?.length || 0}</span><span class="text-xs">bạn bè</span></div>
                        </div>
                    </div>`;
                }

                container.innerHTML = profileHtml + `
                    <div class="bg-white p-5 rounded-lg shadow border border-gray-200">
                        <h4 class="text-sm font-semibold text-gray-500 mb-3">Gợi ý cho bạn</h4>
                        <div class="space-y-3" id="suggested-friends-list">
                            <!-- Suggested friends loaded here -->
                        </div>
                    </div>
                `;
            }
            
            // --- GEMINI CHATBOT ---
            const geminiChatMessages = document.getElementById('gemini-chat-messages');
            const geminiChatInput = document.getElementById('gemini-chat-input');
            const geminiSendButton = document.getElementById('gemini-send-button');
            let chatHistory = [];
            
            function loadChatHistory() {
                 if (!currentUser) {
                    geminiChatMessages.innerHTML = `<div class="gemini-chat-bubble ai"><div class="avatar avatar-ai"><i class="fas fa-brain"></i></div><div class="message-content"><p>Xin chào! Đăng nhập để xem lại lịch sử trò chuyện và bắt đầu nhé!</p></div></div>`;
                    return;
                }
                const chatRef = doc(db, `/artifacts/${appId}/users/${currentUser.uid}/private/chatHistory`);
                 onSnapshot(chatRef, (docSnap) => {
                     if (docSnap.exists() && docSnap.data().messages) {
                         chatHistory = docSnap.data().messages;
                         geminiChatMessages.innerHTML = '';
                         chatHistory.forEach(msg => addGeminiMessage(msg.parts[0].text, msg.role === 'model' ? 'ai' : 'user'));
                     } else {
                         // Start a new chat history
                         const initialMessage = "Xin chào! Mình là HUB AI, người bạn đồng hành học tập của bạn. Bạn cần hỗ trợ gì hôm nay?";
                         chatHistory = [{ role: "model", parts: [{text: initialMessage}]}];
                         geminiChatMessages.innerHTML = '';
                         addGeminiMessage(initialMessage, 'ai');
                     }
                 });
            }

            function addGeminiMessage(message, sender) {
                if (!geminiChatMessages) return;
                const bubbleDiv = document.createElement('div');
                bubbleDiv.classList.add('gemini-chat-bubble', sender);

                const avatarDiv = document.createElement('div');
                avatarDiv.classList.add('avatar');
                if (sender === 'user') {
                    avatarDiv.classList.add('avatar-user');
                    avatarDiv.textContent = currentUserData ? currentUserData.name.charAt(0) : 'SV';
                } else {
                    avatarDiv.classList.add('avatar-ai');
                    avatarDiv.innerHTML = `<i class="fas fa-brain"></i>`;
                }

                const messageContentDiv = document.createElement('div');
                messageContentDiv.classList.add('message-content');
                messageContentDiv.innerHTML = `<p>${message.replace(/\n/g, '<br>')}</p>`;

                if (sender === 'user') {
                    bubbleDiv.appendChild(messageContentDiv);
                    bubbleDiv.appendChild(avatarDiv);
                } else {
                    bubbleDiv.appendChild(avatarDiv);
                    bubbleDiv.appendChild(messageContentDiv);
                }
                
                geminiChatMessages.appendChild(bubbleDiv);
                geminiChatMessages.scrollTop = geminiChatMessages.scrollHeight;
            }
            
            async function handleSendMessage() {
                if (!currentUser) {
                    showToast("Vui lòng đăng nhập để sử dụng chatbot.");
                    openModal(loginModal);
                    return;
                }
                const userMessage = geminiChatInput.value.trim();
                if (!userMessage) return;

                addGeminiMessage(userMessage, 'user');
                geminiChatInput.value = '';

                chatHistory.push({ role: "user", parts: [{ text: userMessage }] });

                const payload = { contents: chatHistory };
                const apiKey = ""; // Provided by Canvas environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates[0]?.content?.parts[0]) {
                        const aiResponse = result.candidates[0].content.parts[0].text;
                        addGeminiMessage(aiResponse, 'ai');
                        chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                        
                        // Save chat history to Firestore
                        const chatRef = doc(db, `/artifacts/${appId}/users/${currentUser.uid}/private/chatHistory`);
                        await setDoc(chatRef, { messages: chatHistory });

                    } else {
                        addGeminiMessage("Xin lỗi, tôi không thể tạo phản hồi lúc này.", 'ai');
                    }
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    addGeminiMessage("Đã có lỗi xảy ra. Vui lòng thử lại.", 'ai');
                }
            }
            
            geminiSendButton.addEventListener('click', handleSendMessage);
            geminiChatInput.addEventListener('keypress', (e) => {
                if(e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });


            // --- STATIC & UI SCRIPT (MODALS, PAGE ROUTING, ETC.) ---
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Page Router
            const pageRouterLinks = document.querySelectorAll('.page-router-link');
            const pageContentSections = document.querySelectorAll('.page-content-section');
            const mainNavLinks = document.querySelectorAll('header nav .nav-link');

            function showPage(targetPageId) {
                pageContentSections.forEach(s => { s.classList.remove('active-page'); s.style.display = 'none'; });
                mainNavLinks.forEach(l => l.classList.remove('active-nav-link'));

                if (targetPageId === 'home') {
                    document.getElementById('hero-section').style.display = 'block';
                    document.getElementById('features-overview').style.display = 'block';
                    document.getElementById('team-section').style.display = 'block';
                    document.querySelector('header nav .nav-link[data-target-page="home"]').classList.add('active-nav-link');
                } else {
                    const targetSection = document.getElementById(targetPageId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        const activeNavLink = document.querySelector(`header nav .nav-link[data-target-page="${targetPageId}"]`);
                        if (activeNavLink) activeNavLink.classList.add('active-nav-link');
                    } else {
                        showPage('home'); // Fallback
                    }
                }
                window.scrollTo(0,0);
            }

            pageRouterLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.dataset.targetPage;
                    if (targetPage) showPage(targetPage);
                });
            });
            showPage('home'); // Initial page

            // Modal Logic
            const loginModal = document.getElementById('login-modal');
            const registerModal = document.getElementById('register-modal');
            const openLoginBtn = document.getElementById('open-login-modal');
            const closeLoginBtn = document.getElementById('close-login-modal');
            const openRegisterBtnCTA = document.getElementById('open-register-modal-cta');
            const closeRegisterBtn = document.getElementById('close-register-modal');
            const showRegisterFromLogin = document.getElementById('show-register-from-login');
            const showLoginFromRegister = document.getElementById('show-login-from-register');

            function openModal(modal) { if (modal) modal.classList.add('active'); }
            function closeModal(modal) { if (modal) modal.classList.remove('active'); }
            
            if (openLoginBtn) openLoginBtn.addEventListener('click', (e) => { e.preventDefault(); openModal(loginModal); });
            if (openRegisterBtnCTA) openRegisterBtnCTA.addEventListener('click', (e) => { e.preventDefault(); openModal(registerModal); });

            [closeLoginBtn, closeRegisterBtn].forEach(btn => {
                if(btn) btn.addEventListener('click', () => { closeModal(loginModal); closeModal(registerModal); });
            });
            
            showRegisterFromLogin.addEventListener('click', (e) => { e.preventDefault(); closeModal(loginModal); openModal(registerModal); });
            showLoginFromRegister.addEventListener('click', (e) => { e.preventDefault(); closeModal(registerModal); openModal(loginModal); });

            // Close modal on overlay click
            [loginModal, registerModal].forEach(modal => {
                if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(modal); });
            });

            // Smooth scroll for "Khám phá" button
            document.getElementById('explore-now-btn').addEventListener('click', function(e) {
                e.preventDefault();
                this.classList.add('magic-effect');
                setTimeout(() => {
                    this.classList.remove('magic-effect');
                    document.getElementById('features-overview').scrollIntoView({ behavior: 'smooth' });
                }, 800);
            });

             // Three.js Hero Animation
            const heroSection = document.querySelector('.hero-section');
            const canvas = document.getElementById('hero-3d-canvas');
            if (heroSection && canvas && typeof THREE !== 'undefined') {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, heroSection.offsetWidth / heroSection.offsetHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
                renderer.setSize(heroSection.offsetWidth, heroSection.offsetHeight);
                renderer.setClearColor(0x000000, 0);

                const starVertices = [];
                for (let i = 0; i < 5000; i++) {
                    const x = (Math.random() - 0.5) * 2000;
                    const y = (Math.random() - 0.5) * 2000;
                    const z = (Math.random() - 0.5) * 2000;
                    starVertices.push(x, y, z);
                }
                const starGeometry = new THREE.BufferGeometry();
                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5 });
                const stars = new THREE.Points(starGeometry, starMaterial);
                scene.add(stars);
                camera.position.z = 5;

                function animate() {
                    requestAnimationFrame(animate);
                    stars.rotation.x += 0.0001;
                    stars.rotation.y += 0.0002;
                    renderer.render(scene, camera);
                }
                animate();

                window.addEventListener('resize', () => {
                    camera.aspect = heroSection.offsetWidth / heroSection.offsetHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(heroSection.offsetWidth, heroSection.offsetHeight);
                });
            }
        });
    </script>
</body>
</html>
